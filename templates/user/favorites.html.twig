{% extends 'base.html.twig' %}

{% block title %}My Favorites - Mentionable{% endblock %}

{% block body %}
    <div class="main-panel">
        <div class="content-wrapper p-0">
            <div class="row justify-content-center mb-4 pt-4">
                <div class="col-lg-8 p-3 justify-content-center">
                    <div class="d-flex flex-row justify-content-center">
                        <h1 class="text-center">
                            Favorite notes
                        </h1>
                        <span class="badge badge-light text-dark mt-2 ms-3" style="height: 25px">{{ notesCount }}</span>
                        {% if favoritesMap|length > 0 %}
                            <a href="{{ path('app_user_clear_favorites', {'id': app.user.id}) }}" style="height: 25px" class="mb-0 pb-0 mt-2 ms-2">
                                <span class="badge badge-light text-dark" style="height: 25px">
                                    Clear all
                                </span>
                            </a>
                        {% endif %}
                    </div>
                </div>
                {# ERROR MESSAGE #}
                {% for label, messages in app.flashes %}
                    {% for message in messages %}
                    <div class="row justify-content-center mb-4">
                        <div class="col-lg-8 col-12 alert alert-{{ label }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    </div>
                    {% endfor %}
                {% endfor %}
                {# NOTES LIST #}
                <div class="row justify-content-center mb-4">
                    {# NOTE #}
                    {% if notes is defined %}
                        <div id="notes-container" class="d-flex flex-column align-items-center">
                            {% include 'default/_note.html.twig' with {
                                notes: notes,
                                votesMap: votesMap,
                                commentVotesMap: commentVotesMap,
                                favoritesMap: favoritesMap,
                                rolesMap: rolesMap,
                                limitedComments: limitedComments,
                            } %}
                        </div>
                    {% else %}
                        <div class="col-lg-7 pt-4 ps-4 pe-4" style="background-color: #181b20; border-radius: 5px; margin-top: 2rem;">
                            <p class="text-light">Oops. No notes available here.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
{{ parent() }}
<script>
    window.votesMap = {{ votesMap|json_encode|raw }};
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const buttons = document.querySelectorAll(".toggle-comments");

    buttons.forEach(button => {
        button.addEventListener("click", function () {
            const noteId = this.getAttribute("data-note-id");
            const commentSection = document.getElementById("comments-" + noteId);

            if (commentSection) {
                if (commentSection.style.display === "none" || commentSection.style.display === "") {
                    commentSection.style.display = "block";
                } else {
                    commentSection.style.display = "none";
                }
            } else {
                console.error("Nu s-a gÄƒsit elementul pentru comentarii cu id: comments-" + noteId);
            }
        });
    });
});
</script>
<script src="{{ asset('../assets/js/feed.js') }}"></script>
<script src="{{ asset('../assets/js/emoji.js') }}"></script>
{% endblock %}