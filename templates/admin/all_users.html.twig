{% extends 'base.html.twig' %}

{% block title %}All reports - Admin - Mentionable{% endblock %}

{% block body %}
    <div class="main-panel">
        <div class="content-wrapper p-0">
            <div class="row justify-content-center mb-4 mt-2">
                <div class="col-lg-8 p-3 justify-content-center">
                    {% for message in app.flashes('success') %}
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                    {% for message in app.flashes('error') %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                </div>
                <div class="col-lg-8 p-3 justify-content-center">
                    <div class="d-flex flex-row justify-content-center">
                        <h1 class="text-center d-none d-md-flex">
                            Users
                        </h1>
                        <h1 class="text-center d-flex d-md-none mt-1" style="font-size: 24px">
                            Users
                        </h1>
                        <span class="badge badge-light text-dark mt-2 ms-2" style="height: 25px">{{ users|length }}</span>
                    </div>
                </div>
                <div class="col-lg-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th> Avatar </th>
                                        <th> Nametag </th>
                                        <th> Email </th>
                                        <th> Role </th>
                                        <th> Joined At </th>
                                        <th> Actions </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% if users is defined and users is not empty %}
                                        {% for user in users %}
                                            <tr>
                                                <td class="py-1">
                                                    <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}"
                                                         alt="Avatar"
                                                         class="img-fluid mt-1 mb-1"
                                                         style="width: 40px; height: auto;"
                                                         onerror="showDefaultUser(this)"/>
                                                </td>
                                                <td> {{ user.nametag }} </td>
                                                <td> {{ user.email }} </td>
                                                <td>
                                                    {% if 'ROLE_ADMIN' in user.roles %}
                                                        Admin{% if 'ROLE_USER' in user.roles %}, User{% endif %}
                                                    {% elseif 'ROLE_USER' in user.roles %}
                                                        User
                                                    {% else %}
                                                        <i class="text-danger">(no roles)</i>
                                                    {% endif %}
                                                </td>
                                                <td> {{ user.creationDate|date('d-m-Y') }} </td>
                                                <td>
                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#userKickManagement{{ user.id }}" class="btn btn-warning">
                                                        <i class="fa fa-trash-o" style="color: white; font-size: 20px"></i>
                                                    </a>
                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#userBanManagement{{ user.id }}" class="btn btn-danger">
                                                        <i class="fa fa-ban" style="color: white; font-size: 20px"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                            <!-- Modal kick user management -->
                                            <div class="modal fade" id="userKickManagement{{ user.id }}" tabindex="-1" aria-labelledby="userKickManagementLabel{{ user.id }}" aria-hidden="true" style="overflow-y: hidden;">
                                                <div class="modal-dialog" style="max-width: 850px;">
                                                    <div class="modal-content" style="background-color: #181b20; border-radius: 5px;">
                                                        <div class="modal-header bg-warning text-white">
                                                            <h5 class="modal-title" id="deleteNoteModalLabel">Confirm kicking the user {{ user.nametag }}</h5>
                                                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are you sure you want to kick this user? This action would result in deleting the user's account and they will be able to register back under the same credentials.
                                                        </div>
                                                        <div class="modal-footer">
                                                            <form method="post" id="deleteUserForm" action="">
                                                                <input type="hidden" name="_token" id="deleteUserTokenInput" value="">
                                                                <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                                                                <button type="submit" class="btn btn-warning">Kick</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Modal ban user management -->
                                            <div class="modal fade" id="userBanManagement{{ user.id }}" tabindex="-1" aria-labelledby="userBanManagementLabel{{ user.id }}" aria-hidden="true" style="overflow-y: hidden;">
                                                <div class="modal-dialog" style="max-width: 850px;">
                                                    <div class="modal-content" style="background-color: #181b20; border-radius: 5px;">
                                                        <div class="modal-header bg-danger text-white">
                                                            <h5 class="modal-title" id="deleteNoteModalLabel">Confirm banning the user {{ user.nametag }}</h5>
                                                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are you sure you want to ban this user? This action would not delete the user's account but instead, it would result in suspending all the website's features for the user until further review from admins.
                                                        </div>
                                                        <div class="modal-footer">
                                                            <form method="post" id="banUserForm" action="">
                                                                <input type="hidden" name="_token" id="banUserTokenInput" value="">
                                                                <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                                                                <button type="submit" class="btn btn-danger">Ban</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                {# USERS LIST #}
{#                <div class="row justify-content-center mb-4">#}
{#                    #}{# USERS #}
{#                    {% if users is defined and users is not empty %}#}
{#                        {% for user in users %}#}
{#                            <div class="preview-item border-bottom d-flex flex-row mt-3">#}
{#                                {% if report.type == 'note' %}#}
{#                                    <a href="{{ path('app_note_show', {'noteId': report.data.note.id}) }}" style="text-decoration: none">#}
{#                                        <div class="preview-thumbnail" style="width: 30px">#}
{#                                            <div class="preview-icon">#}
{#                                                <i class="mdi mdi-file-document"></i>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                {% else %}#}
{#                                    <a href="{{ path('app_note_show', {'noteId': report.data.comment.note.id}) }}" style="text-decoration: none">#}
{#                                        <div class="preview-thumbnail" style="width: 30px">#}
{#                                            <div class="preview-icon">#}
{#                                                <i class="mdi mdi-file-document"></i>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                {% endif %}#}
{#                                <div class="preview-item-content d-sm-flex flex-grow">#}
{#                                    <div class="flex-grow">#}
{#                                        {% if report.type == 'note' %}#}
{#                                            <a href="{{ path('app_note_show', {'noteId': report.data.note.id}) }}" style="text-decoration: none">#}
{#                                                <h5 class="text-white mb-0">Note Report</h5>#}
{#                                            </a>#}
{#                                            {% if report.data.type == 'spam' %}#}
{#                                                <p class="text-danger mb-0">Reason: Spam</p>#}
{#                                            {% elseif report.data.type == 'harassment' %}#}
{#                                                <p class="text-danger mb-0">Reason: Harassment</p>#}
{#                                            {% elseif report.data.type == 'false_info' %}#}
{#                                                <p class="text-danger mb-0">Reason: False information</p>#}
{#                                            {% elseif report.data.type == 'other' %}#}
{#                                                <p class="text-danger mb-0">Reason: Others</p>#}
{#                                            {% elseif report.data.type == 'bad_language' %}#}
{#                                                <p class="text-danger mb-0">Reason: Bad Language</p>#}
{#                                            {% else %}#}
{#                                                <p class="text-success mb-0">Error showing reason</p>#}
{#                                            {% endif %}#}
{#                                            <p>#}
{#                                                Content preview:#}
{#                                                <span class="text-muted">{{ report.data.note.content|slice(0, 80) }}...</span>#}
{#                                            </p>#}
{#                                            <div class="text-sm-right pt-2 pt-sm-0">#}
{#                                                <p class="text-muted">{{ report.data.humanTimePostReport }}</p>#}
{#                                            </div>#}
{#                                        {% else %}#}
{#                                            <a href="{{ path('app_note_show', {'noteId': report.data.comment.note.id}) }}" style="text-decoration: none">#}
{#                                                <h5 class="text-white mb-0">Comment Report</h5>#}
{#                                            </a>#}
{#                                            {% if report.data.type == 'spam' %}#}
{#                                                <p class="text-danger mb-0">Reason: Spam</p>#}
{#                                            {% elseif report.data.type == 'harassment' %}#}
{#                                                <p class="text-danger mb-0">Reason: Harassment</p>#}
{#                                            {% elseif report.data.type == 'false_info' %}#}
{#                                                <p class="text-danger mb-0">Reason: False information</p>#}
{#                                            {% elseif report.data.type == 'other' %}#}
{#                                                <p class="text-danger mb-0">Reason: Others</p>#}
{#                                            {% elseif report.data.type == 'bad_language' %}#}
{#                                                <p class="text-danger mb-0">Reason: Bad Language</p>#}
{#                                            {% else %}#}
{#                                                <p class="text-success mb-0">Error showing reason</p>#}
{#                                            {% endif %}#}
{#                                            <p>#}
{#                                                Content preview:#}
{#                                                <span class="text-muted">{{ report.data.comment.message|slice(0, 80) }}...</span>#}
{#                                            </p>#}
{#                                            <div class="text-sm-right pt-2 pt-sm-0">#}
{#                                                <p class="text-muted">{{ report.data.humanTimeCommentReport }}</p>#}
{#                                            </div>#}
{#                                        {% endif %}#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="mr-auto text-sm-right pt-2 pe-2 pt-sm-0">#}
{#                                    {% if report.data.status == 'pending' %}#}
{#                                        <p class="text-warning">#}
{#                                            {{ report.data.status }}#}
{#                                        </p>#}
{#                                    {% else %}#}
{#                                        <p class="text-success">#}
{#                                            {{ report.data.status }}#}
{#                                        </p>#}
{#                                    {% endif %}#}
{#                                </div>#}
{#                                {% if report.data.status == 'pending' %}#}
{#                                    <a href="#" data-bs-toggle="modal" data-bs-target="#reportManagement{{ report.data.id }}">#}
{#                                        <div class="mr-auto pt-2 pe-2 pt-sm-0">#}
{#                                            <i class='bx bx-folder-check' style="color: #00d25b; font-size: 24px"></i>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                {% else %}#}
{#                                    <div class="mr-auto pt-2 pe-2 pt-sm-0">#}
{#                                        <i class='bx bx-check' style='color:#00d25b; font-size: 24px'></i>#}
{#                                    </div>#}
{#                                {% endif %}#}
{#                            </div>#}
{#                            <!-- Modal report management -->#}
{#                            <div class="modal fade" id="reportManagement{{ report.data.id }}" tabindex="-1" aria-labelledby="reportManagementLabel{{ report.data.id }}" aria-hidden="true" style="overflow-y: hidden;">#}
{#                                <div class="modal-dialog" style="max-width: 850px;">#}
{#                                    <div class="modal-content" style="background-color: #181b20; border-radius: 5px;">#}
{#                                        <div class="modal-body">#}
{#                                            <h5>#}
{#                                                Choose the action management for this report#}
{#                                            </h5>#}
{#                                            #}{# OPTIONS #}
{#                                            <a class="d-flex flex-row p-3 mb-2 mt-4 bg-success text-white" style="text-decoration: none; border-radius: 10px;" href="{{ path('admin_action_done_reports', {'id': report.data.id}) }}">#}
{#                                                <h4 class="m-0 p-0">#}
{#                                                    Reason of reporting is justified and the report is solved#}
{#                                                </h4>#}
{#                                                <div class="ms-auto">#}
{#                                                    <i class='bx bx-check' style='color:#ffffff; font-size: 24px'></i>#}
{#                                                </div>#}
{#                                            </a>#}
{#                                            <a class="d-flex flex-row p-3 mb-2 mt-4 bg-danger text-white" style="text-decoration: none; border-radius: 10px;" href="{{ path('admin_action_none_reports', {'id': report.data.id}) }}">#}
{#                                                <h4 class="m-0 p-0">#}
{#                                                    Reason of reporting is not justified - do nothing#}
{#                                                </h4>#}
{#                                                <div class="ms-auto">#}
{#                                                    <i class='bx bx-hail' style='color:#ffffff; font-size: 24px'></i>#}
{#                                                </div>#}
{#                                            </a>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                        {% endfor %}#}
{#                    {% else %}#}
{#                        <div class="col-lg-7 pt-4 ps-4 pe-4" style="background-color: #181b20; border-radius: 5px; margin-top: 2rem;">#}
{#                            <p class="text-light">Oops. No reports yet.</p>#}
{#                        </div>#}
{#                    {% endif %}#}
{#                </div>#}
            </div>
        </div>
    </div>
{% endblock %}